From 02a0aea6ba28f4dff7eda5a8fd7e9c1cca4856cb Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Fabiano=20Fid=C3=AAncio?= <fidencio@redhat.com>
Date: Sun, 17 Apr 2016 12:58:36 +0200
Subject: [PATCH] unattended: Avoid invalid chars on hostname
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

Microsoft Windows doesn't allow to set a hostname that contains one of
these characters: {|}~[\]^':; <=>?@!"#$%`()+/.,*&

Signed-off-by: Fabiano FidÃªncio <fabianoo@fidencio.org>

https://bugzilla.gnome.org/show_bug.cgi?id=765175
---
 src/unattended-installer.vala | 6 +++++-
 1 file changed, 5 insertions(+), 1 deletion(-)

diff --git a/src/unattended-installer.vala b/src/unattended-installer.vala
index 7e635b7..ac6efee 100644
--- a/src/unattended-installer.vala
+++ b/src/unattended-installer.vala
@@ -114,7 +114,11 @@ private static string escape_mkisofs_path (string path) {
     }
 
     public override void prepare_to_continue_installation (string vm_name) {
-        this.hostname = vm_name.replace (" ", "-");
+        /*
+         * A valid hostname format should be provided by libosinfo.
+         * See: https://bugzilla.redhat.com/show_bug.cgi?id=1328236
+         */
+        this.hostname = replace_regex(vm_name, "[{|}~[\\]^':; <=>?@!\"#$%`()+/.,*&]", "");
 
         var path = get_user_unattended ("unattended.img");
         disk_file = File.new_for_path (path);
-- 
2.5.5

